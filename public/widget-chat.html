<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>



<div id="widget-chat">
    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
            <button type="button" class="btn btn-primary" id="boton-conver"
                    onclick="verConversaciones()">Ver listado de conversaciones</button>
        </div>
    </div>


    <div class="form-group">
        <label class="control-label col-sm-2" for="mensaje">Mensaje:</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" name="mensaje"
                   placeholder="Escribe un mensaje..." id="mensaje" />
        </div>
    </div>

    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
            <button type="button" class="btn btn-primary" id="boton-agregar"
                    onclick="enviarMensaje()">Enviar mensaje</button>
        </div>
    </div>
</div>

<table class="table table-hover">

<tbody id="tablaMensaje">

</tbody>
</table>


</body>
</html>

<script>

    function enviarMensaje( ) {
        $.ajax({
            url: URLbase + "/oferta/mensaje/"+idOfertaSeleccionada,
            type: "POST",
            data: {
                texto : $("#mensaje").val()
            },
            dataType: 'json',
            headers: { "token": token },
            success: function(respuesta){
                console.log(respuesta);
                cargarMensajes();
            },
            error : function (eror) {
                $( "#contenedor-principal" ).load("widget-login.html");
            }
        });

    }

    var mensajes;
    function cargarMensajes() {
        $.ajax({
            url: URLbase + "/oferta/mensaje/"+idOfertaSeleccionada,
            type: "GET",
            data: {},
            dataType: 'json',
            headers: {"token": token},
            success: function (respuesta) {
                mensajes = respuesta;
                actualizarTabla(mensajes);
            },
            error: function (error) {
               $("#contenedor-principal").load("widget-login.html");
            }
        });
    }


    function actualizarTabla(mensajeMostrar) {
        console.log(mensajeMostrar);
        $("#tablaMensaje").empty(); // Vaciar la tabla
        for (i = 0; i < mensajeMostrar.length; i++) {
            if (mensajeMostrar[i].emisor == Cookies.get('usuarioEnSesion')) {
                $("#tablaMensaje").append(

                "<tr style='text-align:left'>" +
                "<td>" + mensajeMostrar[i].emisor + "</td>" +
                "<td>" + mensajeMostrar[i].texto + "</td>" +
                "<td type='date''>" + mensajeMostrar[i].fecha + "</td>" +
                "<td>" +
                "</tr>")
            }
            if (mensajeMostrar[i].emisor != Cookies.get('usuarioEnSesion')){
                $("#tablaMensaje").append(
                "<tr style='text-align:right'>"+
                "<td>"+mensajeMostrar[i].receptor+"</td>" +
                "<td>"+mensajeMostrar[i].texto+"</td>" +
                "<td type='date''>"+mensajeMostrar[i].fecha+"</td>" +
                "<td>"+
                "</tr>");

        }
    };


    }

    function verConversaciones() {
        $( "#contenedor-principal" ).load( "widget-conversaciones.html");
    }

        $(document).ready(function () {
            setTimeout(cargarMensajes, 1000);
        });

</script>